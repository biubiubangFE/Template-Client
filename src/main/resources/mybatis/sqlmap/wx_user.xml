<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mhdss.dc.dao.WxUserDAO">

    <sql id="insert_columns">
    (open_id, union_id, blance, total, nick_name, avatar_url, c_time, m_time, status)
  </sql>

    <sql id="insert_values">
    (#{openId}, #{unionId}, #{blance}, #{total}, #{nickName}, #{avatarUrl}, #{cTime}, #{mTime}, #{status})
  </sql>

    <sql id="query_columns">
    id, open_id AS openId, union_id AS unionId, blance, total ,nick_name AS nickName, avatar_url AS avatarUrl, c_time AS cTime, m_time AS mTime, status
  </sql>

    <sql id="where">
        <where>
            <if test="openId != null">
                AND open_id = #{openId}
            </if>
            <if test="unionId != null">
                AND union_id = #{unionId}
            </if>
        </where>
    </sql>

    <sql id="limit_where">
        <include refid="where"/>
        <if test="range != 0">
            LIMIT ${start}, ${range}
        </if>
    </sql>

    <insert id="insert" parameterType="com.mhdss.dc.dataobject.WxUserDO">
        <selectKey keyProperty="id" resultType="long">
            SELECT LAST_INSERT_ID() AS id
        </selectKey>
        INSERT INTO wx_user
        <include refid="insert_columns"/>
        VALUES
        <include refid="insert_values"/>
    </insert>

    <update id="insertUpdateOnDuplicate" parameterType="com.mhdss.dc.dataobject.WxUserDO">
        <selectKey keyProperty="id" resultType="long">
            SELECT LAST_INSERT_ID() AS id
        </selectKey>
        INSERT INTO wx_user
        <include refid="insert_columns"/>
        VALUES
        <include refid="insert_values"/>
        ON DUPLICATE KEY UPDATE m_time = #{mTime}, id = LAST_INSERT_ID(id)
    </update>

    <update id="updateById" parameterType="com.mhdss.dc.dataobject.WxUserDO">
        UPDATE wx_user
        <set>
            <if test="openId != null">
                open_id = #{openId},
            </if>
            <if test="unionId != null">
                union_id = #{unionId},
            </if>
            <if test="blance != null">
                blance = #{blance},
            </if>
            <if test="total != null">
                total = #{total},
            </if>
            <if test="nickName != null">
                nick_name = #{nickName},
            </if>
            <if test="avatarUrl != null">
                avatar_url = #{avatarUrl},
            </if>
            <if test="cTime != null">
                c_time = #{cTime},
            </if>
            <if test="mTime != null">
                m_time = #{mTime},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="updateByIds" parameterType="java.util.Map">
        UPDATE wx_user
        <set>
            <if test="target.openId != null">
                open_id = #{target.openId},
            </if>
            <if test="target.unionId != null">
                union_id = #{target.unionId},
            </if>
            <if test="target.blance != null">
                blance = #{target.blance},
            </if>
            <if test="target.total != null">
                total = #{target.total},
            </if>
            <if test="target.nickName != null">
                nick_name = #{target.nickName},
            </if>
            <if test="target.avatarUrl != null">
                avatar_url = #{target.avatarUrl},
            </if>
            <if test="target.cTime != null">
                c_time = #{target.cTime},
            </if>
            <if test="target.mTime != null">
                m_time = #{target.mTime},
            </if>
            <if test="target.status != null">
                status = #{target.status},
            </if>
        </set>
        WHERE id IN
        <foreach close=")" collection="ids" item="id" open="(" separator=",">
            #{id}
        </foreach>
    </update>

    <delete id="deleteById" parameterType="long">
    DELETE FROM wx_user WHERE id = #{id}
  </delete>

    <delete id="deleteByIds" parameterType="java.util.Collection">
        DELETE FROM wx_user WHERE id IN
        <foreach close=")" collection="collection" item="id" open="(" separator=",">
            #{id}
        </foreach>
    </delete>

    <select id="selectById" parameterType="long" resultType="com.mhdss.dc.dataobject.WxUserDO">
        SELECT
        <include refid="query_columns"/>
        FROM wx_user WHERE id = #{id}
    </select>

    <select id="selectIdsByQuery" parameterType="com.mhdss.dc.query.WxUserQuery" resultType="long">
        SELECT id FROM wx_user
        <include refid="limit_where"/>
    </select>

    <select id="selectByIds" parameterType="java.util.Collection" resultType="com.mhdss.dc.dataobject.WxUserDO">
        SELECT
        <include refid="query_columns"/>
        FROM wx_user WHERE id IN
        <foreach close=")" collection="collection" item="id" open="(" separator=",">
            #{id}
        </foreach>
    </select>

    <select id="selectCount" parameterType="com.mhdss.dc.query.WxUserQuery" resultType="int">
        SELECT COUNT(*) FROM wx_user
        <include refid="where"/>
    </select>

    <select id="selectList" parameterType="com.mhdss.dc.query.WxUserQuery"
            resultType="com.mhdss.dc.dataobject.WxUserDO">
        SELECT
        <include refid="query_columns"/>
        FROM wx_user
        <include refid="limit_where"/>
    </select>

    <update id="addBlanceAndTotal" parameterType="map">

        UPDATE wx_user
        <set>
            <if test="totalPrice != null">
                total =total + #{totalPrice},
            </if>
            <if test="blancePrice != null">
                blance = blance +#{blancePrice},
            </if>
        </set>
        WHERE id = #{id}
    </update>


</mapper>